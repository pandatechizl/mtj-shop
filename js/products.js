// products.js
const products = [
  {
    id: 1,
    name: "Gold Charm Necklace",
    price: 2200,
    description: "Gold necklace with leaf charm",
    imageUrl: "assets/images/diamond2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 2,
    name: "Minimalist Bracelet",
    price: 1400,
    description: "Simple bracelet for daily wear",
    imageUrl: "assets/images/sapphire_pa2.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 3,
    name: "Pearl Drop Earrings",
    price: 1800,
    description: "Elegant pearl drop earrings",
    imageUrl: "assets/images/hoop5.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 4,
    name: "Stackable Rings Set",
    price: 1600,
    description: "Gold-plated rings set",
    imageUrl: "assets/images/diamondRing1.webp",
    category: "newArrival",
    details: {
      item: "Ring",
      color: "Yellow Gold",
      size: "10",
      weight: "3g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 5,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/ruby_ne0.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 6,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/ruby_ne1.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 7,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/ruby_ne2.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 8,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/ruby_ne3.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 9,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/ruby_ne4.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 10,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/sapphire_pa1.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 11,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/sapphire_pa2.webp",
    category: "newArrival",
    details: {
      item: "Necklace",
      color: "Yellow Gold",
      size: "18 inches",
      weight: "15g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 12,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br1.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 13,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br2.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 14,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br3.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 15,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br4.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 16,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br5.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 17,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/gold_br6.webp",
    category: "newArrival",
    details: {
      item: "Bracelet",
      color: "Yellow Gold",
      size: "10 inches",
      weight: "7g",
      stones: "None",
      material: "18K Gold"
      }
  },
  {
    id: 18,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond1.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 19,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 20,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond3.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 21,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond4.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 22,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond5.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 23,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamond6.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 24,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop1.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 25,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 26,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop3.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 27,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop4.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 28,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop5.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 29,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/drop6.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 30,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop1.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 31,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 32,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop3.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 33,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop4.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 34,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop5.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 35,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/hoop6.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 36,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl1.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 37,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 38,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl3.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 39,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl4.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 40,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl5.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 41,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/pearl6.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 42,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamondRing2.webp",
    category: "newArrival",
    details: {
      item: "Ring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 43,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamondRing3.webp",
    category: "newArrival",
    details: {
      item: "Ring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 44,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/diamondRing4.webp",
    category: "newArrival",
    details: {
      item: "Ring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 45,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/goldRing1.webp",
    category: "newArrival",
    details: {
      item: "Ring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  },
  {
    id: 46,
    name: "",
    price: 0,
    description: "",
    imageUrl: "assets/images/goldRing2.webp",
    category: "newArrival",
    details: {
      item: "Earring",
      color: "Yellow Gold",
      size: "0.8 inches",
      weight: "7g",
      stones: "Natural Pearl",
      material: "18K Gold"
      }
  }
];

// Main render function
//function renderProducts(filterCategory = "all") {
//  const container = document.getElementById("product-list");
//  if (!container) return;
//
//  // Filter products by category
//  const filteredProducts =
//    filterCategory === "all"
//      ? products
//      : products.filter(p => p.category === filterCategory);
//
//  // Render product cards
//  container.innerHTML = filteredProducts
//    .map(
//      p => `
//      <div class="product" onclick="viewProduct(${p.id})">
//      <img src="${p.imageUrl}" alt="${p.name}">
//        <div class="info">
//          <h3>${p.name}</h3>
//          <p>${p.description}</p>
//          <p class="price">$${p.price.toFixed(2)}</p>
//          <button onclick="event.stopPropagation(); addToCart(${p.id})">Add to Cart</button>
//        </div>
//      </div>
//    `
//    )
//    .join("");
//}

// Product view handler
function viewProduct(productId) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  localStorage.setItem("selectedProduct", JSON.stringify(product));
  window.location.href = "product.html"; // navigate to product detail page
}

// Auto-detect which page is being loaded
document.addEventListener("DOMContentLoaded", () => {
  const page = window.location.pathname;

  if (page.includes("index.html") || page.includes("new-arrivals.html")) {
    renderProducts("newArrival");
  } else if (page.includes("collections.html")) {
    renderProducts("all");
  } else {
	renderProducts("newArrival");
  }
});

// ----------------------
// Modal + Category Gallery
// ----------------------
const modal = document.getElementById("imageModal");
const modalImg = document.getElementById("modalImage");
const closeBtn = document.querySelector(".close");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

let currentCategoryImages = [];
let currentIndex = 0;

// Open popup for selected category (Bracelet, Ring, etc.)
function openCategoryGallery(categoryItem) {
  // Filter all products where details.item matches category
  currentCategoryImages = products
    .filter(p => p.details.item.toLowerCase() === categoryItem.toLowerCase())
    .map(p => p.imageUrl);

  if (currentCategoryImages.length === 0) return;

  currentIndex = 0;
  modal.style.display = "block";
  modalImg.src = currentCategoryImages[currentIndex];
  document.body.style.overflow = "hidden"; // prevent background scroll
}

function showNextImage() {
  const img = modalImg;
  img.classList.remove("fade-in");
  img.classList.add("slide-next");

  const nextIndex = (currentIndex + 1) % currentCategoryImages.length;
  const newSrc = currentCategoryImages[nextIndex];

  // Preload next image
  const tempImg = new Image();
  tempImg.src = newSrc;
  tempImg.onload = () => {
    // After animation out
    setTimeout(() => {
      currentIndex = nextIndex;
      img.src = newSrc;
      img.classList.remove("slide-next");
      // Trigger fade-in once image is fully ready
      requestAnimationFrame(() => {
        img.classList.add("fade-in");
      });
    }, 250); // matches CSS duration
  };
}

function showPrevImage() {
  const img = modalImg;
  img.classList.remove("fade-in");
  img.classList.add("slide-prev");

  const prevIndex = (currentIndex - 1 + currentCategoryImages.length) % currentCategoryImages.length;
  const newSrc = currentCategoryImages[prevIndex];

  // Preload previous image
  const tempImg = new Image();
  tempImg.src = newSrc;
  tempImg.onload = () => {
    setTimeout(() => {
      currentIndex = prevIndex;
      img.src = newSrc;
      img.classList.remove("slide-prev");
      requestAnimationFrame(() => {
        img.classList.add("fade-in");
      });
    }, 250);
  };
}


// Close modal
closeBtn.onclick = () => {
  modal.style.display = "none";
  document.body.style.overflow = "auto";
};

// Click outside modal closes it
window.onclick = e => {
  if (e.target === modal) {
    modal.style.display = "none";
    document.body.style.overflow = "auto";
  }
};

// Button listeners
nextBtn.onclick = showNextImage;
prevBtn.onclick = showPrevImage;

let startX = 0;

modalImg.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
});

modalImg.addEventListener("touchend", e => {
  let endX = e.changedTouches[0].clientX;
  let diff = startX - endX;

  if (Math.abs(diff) > 50) {
    if (diff > 0) showNextImage();   // Swipe left → next
    else showPrevImage();            // Swipe right → prev
  }
});

document.addEventListener("keydown", e => {
  if (modal.style.display === "block") {
    if (e.key === "ArrowRight") showNextImage();
    if (e.key === "ArrowLeft") showPrevImage();
    if (e.key === "Escape") modal.style.display = "none";
  }
});

// ===========================
// Rotating Carousel Generator (Dynamic from products.js)
// ===========================
document.addEventListener("DOMContentLoaded", () => {
  const carouselTrack = document.getElementById("carouselTrack");
  if (!carouselTrack) return;

  // Collect all unique image URLs from products.js
  const imagePaths = [...new Set(products.map(p => p.imageUrl))];

  // Duplicate the list for smooth infinite scrolling
  const allImages = [...imagePaths, ...imagePaths];

  allImages.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    img.alt = "Jewellery item";
    carouselTrack.appendChild(img);
  });
});

// ==============================
// Robust Hero Carousel
// ==============================

function initHeroCarousel(retryCount = 0) {
  const slides = document.querySelectorAll(".carousel-slide");
  if (!slides.length) {
    // Retry if DOM not yet loaded (up to 10 times, every 300ms)
    if (retryCount < 10) {
      setTimeout(() => initHeroCarousel(retryCount + 1), 300);
    }
    return;
  }

  let index = 0;

  function showSlide(i) {
    slides.forEach((slide, idx) => {
      slide.classList.toggle("active", idx === i);
    });
  }

  // Show first slide
  showSlide(index);

  // Auto-slide every 6 seconds
  setInterval(() => {
    index = (index + 1) % slides.length;
    showSlide(index);
  }, 3000);
}

// Initialize when window fully loaded
window.addEventListener("load", () => {
  initHeroCarousel();
});

// ==============================
// Smooth Scroll / Cross-Page CTA
// ==============================
function scrollToSection(sectionId, targetPage = null) {
  const currentPath = window.location.pathname;
  
  // If a target page is provided and user is not already there
  if (targetPage && !currentPath.includes(targetPage)) {
    // Redirect and store target section in localStorage
    localStorage.setItem("scrollTarget", sectionId);
    window.location.href = `${targetPage}#${sectionId}`;
    return;
  }

  // If already on the correct page, scroll smoothly
  const target = document.getElementById(sectionId);
  if (target) {
    target.scrollIntoView({ behavior: "smooth" });
  }
}

// ==============================
// Handle Post-Navigation Scroll
// ==============================
window.addEventListener("DOMContentLoaded", () => {
  const storedTarget = localStorage.getItem("scrollTarget");
  if (storedTarget) {
    const element = document.getElementById(storedTarget);
    if (element) {
      setTimeout(() => {
        element.scrollIntoView({ behavior: "smooth" });
      }, 500); // delay to ensure content is fully rendered
    }
    localStorage.removeItem("scrollTarget");
  }
});
